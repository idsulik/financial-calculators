<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Savings Goal Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* gray-50 */
        }
        /* Animation */
        .input-section, .summary-section, .chart-section {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Input styling */
        input[type="number"] {
            appearance: textfield; -moz-appearance: textfield;
        }
        /* Icon styling */
        .icon {
            width: 1.25rem; height: 1.25rem; display: inline-block;
            vertical-align: middle; margin-right: 0.5rem; opacity: 0.7;
        }
        .placeholder-icon {
            width: 1.25rem; height: 1.25rem; background-color: #e2e8f0; /* gray-300 */
            border-radius: 0.25rem; display: inline-block;
            vertical-align: middle; margin-right: 0.5rem;
        }
        /* Chart container height */
         .chart-container canvas {
            max-height: 400px;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-5xl mx-auto bg-white p-6 md:p-8 rounded-xl shadow-lg">

        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-8 text-center">Savings Goal Calculator</h1>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="md:col-span-1 space-y-4 input-section">
                 <div>
                    <label for="savingsGoal" class="flex items-center text-sm font-medium text-gray-700 mb-1">
                        <img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/target.svg" alt="Goal" class="icon" onerror="this.outerHTML='<span class=\'placeholder-icon\'></span>'"> Savings Goal ($)
                    </label>
                    <input type="number" id="savingsGoal" value="50000" min="1" step="1000" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                 <div>
                    <label for="currentSavings" class="flex items-center text-sm font-medium text-gray-700 mb-1">
                         <img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/piggy-bank.svg" alt="Current Savings" class="icon" onerror="this.outerHTML='<span class=\'placeholder-icon\'></span>'"> Current Amount Saved ($)
                    </label>
                    <input type="number" id="currentSavings" value="5000" min="0" step="500" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                 <div>
                    <label for="yearsToSave" class="flex items-center text-sm font-medium text-gray-700 mb-1">
                         <img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/calendar-clock.svg" alt="Time" class="icon" onerror="this.outerHTML='<span class=\'placeholder-icon\'></span>'"> Years to Save
                    </label>
                    <input type="number" id="yearsToSave" value="5" min="1" max="50" step="1" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                 <div>
                    <label for="annualRate" class="flex items-center text-sm font-medium text-gray-700 mb-1">
                         <img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/percent.svg" alt="Rate" class="icon" onerror="this.outerHTML='<span class=\'placeholder-icon\'></span>'"> Estimated Annual Interest Rate (%)
                    </label>
                    <input type="number" id="annualRate" value="4" min="0" max="20" step="0.1" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                 <button id="calculateBtnSavings" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-md shadow transition duration-150 ease-in-out mt-2">
                    Calculate Monthly Savings
                </button>
            </div>

            <div class="md:col-span-2 summary-section bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-lg flex flex-col justify-center items-center text-center shadow-inner">
                <h2 class="text-xl font-semibold text-indigo-800 mb-4">Savings Projection</h2>
                <div class="mb-6">
                    <p class="text-sm text-gray-600">Required Monthly Savings</p>
                    <p id="monthlySavingsNeeded" class="text-3xl font-bold text-indigo-600">$0.00</p>
                     <p id="goalMessage" class="text-sm text-green-600 font-medium mt-1 hidden"></p>
                </div>
                <div class="w-full grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm mb-6">
                    <div>
                        <p class="text-gray-600">Target Goal</p>
                        <p id="summaryGoal" class="text-lg font-medium text-gray-800">$0.00</p>
                    </div>
                     <div>
                        <p class="text-gray-600">Total Contributions Needed</p>
                        <p id="summaryContributions" class="text-lg font-medium text-gray-800">$0.00</p>
                    </div>
                     <div>
                        <p class="text-gray-600">Estimated Total Interest</p>
                        <p id="summaryInterest" class="text-lg font-medium text-green-600">$0.00</p>
                    </div>
                </div>
                 <p id="savingsCalculationError" class="text-red-500 text-sm mt-2 hidden">Please enter valid details.</p>
            </div>
        </div>

        <div class="chart-section bg-gray-50 p-4 rounded-lg shadow-inner chart-container">
             <h2 class="text-lg font-semibold text-gray-700 mb-4 text-center">Projected Growth Towards Goal</h2>
            <canvas id="savingsChart"></canvas>
            <p id="savingsChartError" class="text-center text-gray-500 text-sm mt-2 hidden">Calculate savings needed to view the chart.</p>
        </div>

         <div class="mt-8 p-4 border-t border-gray-200 text-sm text-gray-600">
            <h3 class="font-semibold text-gray-700 mb-2">How It Works:</h3>
            <ul class="list-disc list-inside space-y-1">
                <li>Enter your desired savings goal, how much you've already saved, the time you have, and an estimated annual interest rate.</li>
                <li>The calculator determines the fixed amount you need to save each month to reach your goal.</li>
                <li>The chart visualizes how your savings (initial + contributions + interest) grow over time compared to your target.</li>
            </ul>
            <p class="mt-2 italic">Note: This assumes consistent monthly savings and a fixed interest rate. Actual returns may vary. Does not account for taxes or inflation.</p>
        </div>

    </div>

    <script>
        // --- DOM Elements ---
        const savingsGoalInput = document.getElementById('savingsGoal');
        const currentSavingsInput = document.getElementById('currentSavings');
        const yearsToSaveInput = document.getElementById('yearsToSave');
        const annualRateInput = document.getElementById('annualRate');
        const calculateBtnSavings = document.getElementById('calculateBtnSavings');

        const monthlySavingsNeededDisplay = document.getElementById('monthlySavingsNeeded');
        const goalMessageDisplay = document.getElementById('goalMessage');
        const summaryGoalDisplay = document.getElementById('summaryGoal');
        const summaryContributionsDisplay = document.getElementById('summaryContributions');
        const summaryInterestDisplay = document.getElementById('summaryInterest');
        const savingsCalculationError = document.getElementById('savingsCalculationError');
        const savingsChartError = document.getElementById('savingsChartError');

        const savingsChartCtx = document.getElementById('savingsChart').getContext('2d');
        let savingsChart; // Chart instance

        // --- Helper Functions ---
        const formatCurrency = (value) => {
            if (!isFinite(value)) return '$ --';
            // Use more precision for monthly savings
            if (Math.abs(value) < 10000) {
                 return value.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2 });
            }
            // Use less precision for large goal numbers
            return value.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 });
        };


        // --- Calculation Logic ---
        function calculateSavingsGoal() {
            // Clear previous errors/states
            savingsCalculationError.classList.add('hidden');
            savingsChartError.classList.add('hidden');
            goalMessageDisplay.classList.add('hidden');
            goalMessageDisplay.textContent = '';

            // Get inputs
            const futureValue = parseFloat(savingsGoalInput.value); // FV (Goal)
            const presentValue = parseFloat(currentSavingsInput.value) || 0; // PV (Current Savings)
            const years = parseInt(yearsToSaveInput.value);
            const annualRate = parseFloat(annualRateInput.value) / 100 || 0;

            // Validate inputs
            if (isNaN(futureValue) || isNaN(presentValue) || isNaN(years) || isNaN(annualRate) ||
                futureValue <= 0 || presentValue < 0 || years <= 0) {
                savingsCalculationError.textContent = 'Please enter a valid goal, current savings, years, and rate.';
                savingsCalculationError.classList.remove('hidden');
                // Reset displays
                monthlySavingsNeededDisplay.textContent = '$0.00';
                summaryGoalDisplay.textContent = '$0';
                summaryContributionsDisplay.textContent = '$0';
                summaryInterestDisplay.textContent = '$0';
                 if (savingsChart) savingsChart.destroy();
                 savingsChartError.textContent = 'Invalid input. Cannot generate chart.';
                 savingsChartError.classList.remove('hidden');
                return;
            }

             if (presentValue >= futureValue) {
                // Goal already reached or exceeded
                monthlySavingsNeededDisplay.textContent = formatCurrency(0);
                goalMessageDisplay.textContent = 'Goal already reached!';
                goalMessageDisplay.classList.remove('hidden');
                summaryGoalDisplay.textContent = formatCurrency(futureValue);
                summaryContributionsDisplay.textContent = formatCurrency(0); // No further contributions needed
                summaryInterestDisplay.textContent = formatCurrency(0); // No further interest calculated here
                 if (savingsChart) savingsChart.destroy(); // Clear chart if goal met
                 savingsChartError.textContent = 'Goal already reached. No projection needed.';
                 savingsChartError.classList.remove('hidden');
                return;
            }


            const periods = years * 12; // n
            const monthlyRate = annualRate / 12; // r

            let monthlyPayment; // PMT

            // Calculate Required Monthly Payment (PMT)
            if (monthlyRate === 0) { // No interest
                monthlyPayment = (futureValue - presentValue) / periods;
            } else {
                // FV = PV*(1+r)^n + PMT * [((1+r)^n - 1) / r]
                // PMT = (FV - PV*(1+r)^n) / [((1+r)^n - 1) / r]
                const factor = Math.pow(1 + monthlyRate, periods);
                monthlyPayment = (futureValue - presentValue * factor) / ((factor - 1) / monthlyRate);
            }

             // Check if calculated PMT is negative (means goal reached without further saving)
             if (monthlyPayment <= 0) {
                monthlyPayment = 0;
                goalMessageDisplay.textContent = 'Goal will be reached with current savings and interest alone!';
                goalMessageDisplay.classList.remove('hidden');
             }


            // --- Simulate growth for chart and summary ---
            let balance = presentValue;
            let totalContributions = 0;
            let totalInterest = 0;
            const growthData = []; // { month, contributions, interest, total }

            growthData.push({ month: 0, contributions: presentValue, interest: 0, total: balance }); // Initial state

            for (let month = 1; month <= periods; month++) {
                balance += monthlyPayment; // Add contribution for the month
                totalContributions += monthlyPayment;

                let interestThisMonth = balance * monthlyRate;
                totalInterest += interestThisMonth;

                balance += interestThisMonth; // Add interest

                 // Store data point
                 growthData.push({
                    month: month,
                    // Cumulative values for stacked chart:
                    contributions: presentValue + totalContributions,
                    interest: totalInterest,
                    total: balance
                });
            }


            // Update Summary Display
            monthlySavingsNeededDisplay.textContent = formatCurrency(monthlyPayment);
            summaryGoalDisplay.textContent = formatCurrency(futureValue);
            summaryContributionsDisplay.textContent = formatCurrency(totalContributions); // Only the needed contributions
            summaryInterestDisplay.textContent = formatCurrency(totalInterest);


            // Update Chart
            updateSavingsChart(growthData, futureValue);
        }

        // --- Charting Logic ---
        function updateSavingsChart(growthData, goalAmount) {
             if (!growthData || growthData.length <= 1) {
                if (savingsChart) savingsChart.destroy();
                savingsChartError.textContent = 'Not enough data to display chart.';
                savingsChartError.classList.remove('hidden');
                return;
            }
            savingsChartError.classList.add('hidden');

            const labels = growthData.map(data => `Month ${data.month}`);
            const contributionData = growthData.map(data => data.contributions); // Initial + added
            const interestData = growthData.map(data => data.interest);
            const goalLineData = Array(growthData.length).fill(goalAmount); // Line showing the goal

            const chartData = {
                labels: labels,
                datasets: [
                    {
                        label: 'Total Contributions',
                        data: contributionData,
                        backgroundColor: 'rgba(99, 102, 241, 0.5)', // Indigo-500
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 1,
                        fill: true,
                        stack: 'savingsStack',
                        order: 2 // Render below interest
                    },
                    {
                        label: 'Total Interest Earned',
                        data: interestData,
                        backgroundColor: 'rgba(22, 163, 74, 0.5)', // Green-600
                        borderColor: 'rgba(22, 163, 74, 1)',
                        borderWidth: 1,
                        fill: true,
                        stack: 'savingsStack',
                        order: 1 // Render on top
                    },
                     {
                        label: 'Savings Goal',
                        data: goalLineData,
                        borderColor: 'rgba(220, 38, 38, 0.8)', // Red-600
                        borderWidth: 2,
                        borderDash: [5, 5], // Dashed line
                        fill: false,
                        pointRadius: 0, // No points on the goal line
                        type: 'line', // Ensure this is a line chart overlay
                        order: 0 // Render on top of bars/area
                    }
                ]
            };

            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                 // Use 'bar' type for stacking, but line for goal
                scales: {
                     x: {
                        stacked: true,
                        title: { display: true, text: 'Months' }
                    },
                    y: {
                        stacked: true,
                        beginAtZero: true,
                        title: { display: true, text: 'Projected Value ($)' },
                        ticks: {
                            callback: function(value) { return formatCurrency(value); }
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                             label: function(context) {
                                // Don't show tooltip for the goal line itself
                                if (context.dataset.label === 'Savings Goal') {
                                    return null; // Hide tooltip label for goal line
                                }
                                let label = context.dataset.label || '';
                                if (label) { label += ': '; }
                                label += formatCurrency(context.parsed.y);
                                return label;
                            },
                             footer: function(tooltipItems) {
                                let sum = 0;
                                tooltipItems.forEach(function(tooltipItem) {
                                     // Sum only the stacked datasets
                                    if(tooltipItem.dataset.stack === 'savingsStack') {
                                         sum += tooltipItem.parsed.y;
                                    }
                                });
                                // Don't show footer if only goal line is hovered (or no items)
                                if (tooltipItems.length === 0 || (tooltipItems.length === 1 && tooltipItems[0].dataset.label === 'Savings Goal')) {
                                     return '';
                                }
                                return 'Total Value: ' + formatCurrency(sum);
                            }
                        }
                    },
                    legend: {
                        position: 'top',
                    }
                },
                 interaction: {
                    mode: 'index',
                    intersect: false
                }
            };

            if (savingsChart) {
                savingsChart.destroy();
            }

            // Use 'bar' type overall - the goal line dataset overrides its type to 'line'
            savingsChart = new Chart(savingsChartCtx, {
                type: 'bar',
                data: chartData,
                options: chartOptions
            });
        }


        // --- Event Listeners ---
        calculateBtnSavings.addEventListener('click', calculateSavingsGoal);

        // --- Initial State ---
        document.addEventListener('DOMContentLoaded', () => {
            monthlySavingsNeededDisplay.textContent = '$0.00';
            summaryGoalDisplay.textContent = '$0';
            summaryContributionsDisplay.textContent = '$0';
            summaryInterestDisplay.textContent = '$0';
            savingsChartError.textContent = 'Enter details and click Calculate to view projection.';
            savingsChartError.classList.remove('hidden');
            calculateSavingsGoal();
        });

    </script>
</body>
</html>
